---
title: StoryPipeline——一款可高度自定义的小说工作流
date: 2025-12-18
category: 技术探索
author: "@王映寒"
---
前几个月给自己的个人小说挖了个坑，我之前尝试了很多方法用ai帮我完成，比如Obsidian自带一些第三方插件，但是效果总是差强人意，我在github上也搜过不少小说工作流，但是往往都是黑箱，可自定义化比较低，因而我花费了很多天时间，自己去写了这么一个项目。下面对目前的项目进行一个介绍，稍后我会发布在github上。

这是一个用于 **创作与管理长篇小说** 的结构化写作工作流项目。  
它将小说创作视为一个长期、可维护的过程，而不是一次性的文本生成任务。

目前该项目以 **后端工作流** 的形式存在，强调 **半自动生成 + 人工可控修改**，适合希望对创作过程保持高度掌控的作者。

---
## 项目理念

长篇小说创作的真正难点，往往不在于“写不出文字”，而在于：
- 结构逐渐失控  
- 设定在中后期相互冲突  
- 修改成本随篇幅急剧上升  

StoryPipeline 的核心理念是：

> 让结构先行，让文本在结构内生长。

技术并不替代创作决策，而是用于降低管理复杂度。

---
## 当前形态与设计取向

- 项目目前仅包含 **后端代码与文件工作流**  
- 尚未设计前端交互界面  
- 未引入 embedding 或自动语义检索机制  

这种取向是**有意为之**的：

- 所有设定与内容均以可读文件形式存在  
- 作者可以直接、精确地修改任意部分  
- 系统只在明确调用时才参与生成或校验  

因此，这是一个 **半自动、高可定制化** 的创作系统，而非“全自动写作工具”。

---
## 正常的创作流程（核心逻辑）

StoryPipeline 采用 **自上而下（Top-down）** 的创作顺序，并明确区分设定层与生成层。
### 1. 小说总纲（Story Overview.md）

创作从小说总纲开始，用于明确：

- 主题与核心问题  
- 主线矛盾  
- 整体叙事方向  

总纲是最高层级的约束，后续内容必须与之保持一致。

---
### 2. 阶段性剧情规划（Storyline.csv）

在总纲之下，将故事拆分为若干 **阶段性剧情**，例如：

- 第 1–5 章：铺垫与世界观建立
- 第 6–12 章：冲突展开，张三统治了世界？
- 第 13–20 章：升级与收束，大家皆大欢喜...

这一层关注的是 **结构与节奏**。

---
### 3. 章节结构与事件（Chapters / Events）

在阶段规划基础上，进一步拆解到章节层面：

- 每一章的目标与功能  
- 情绪与叙事定位  
- 关键章节事件  

**章节事件用于串联章节之间的因果关系**，是故事连续推进的结构骨架。

---
### 4. 人物、国家与阵营设定

在章节结构稳定后，补充和维护相对长期有效的设定层：

- 人物设定（性格、动机、关系）  
- 国家、组织与阵营  
- 宏观世界观背景 

这些内容以结构化文件保存，为生成与检查提供参考。

---
### 5. 正文生成与时间线摘要（storyline.md）

当某一章节正文生成完成后，系统会自动：

- 从已完成章节中提炼 **时间线摘要**
- 记录关键事件、人物状态变化与剧情进展  

这条时间线并非预设，而是 **事后生成的凝练结果**，  
其主要作用是：

> 作为下一章生成时的参考上下文。

通过这种方式，系统在不依赖 embedding 的情况下，仍能保持长篇叙事的连续性。

---
## 项目架构概览
### 核心入口

`main.py`  
  负责调度各阶段流程与数据读写。
  
---
### 模型与生成层

`llm_client.py`  
  封装语言模型调用逻辑，在明确设定约束下生成文本。
  
---
### 代理模块（Agents）

`logic_agent.py`  
  用于检测人物行为、时间线与设定的一致性问题。
  
`style_agent.py`  
  用于控制文本风格与表达一致性。

---
### 内容与数据层
`chapters/`
  存放各章节正文，每一章都是独立、可直接编辑的文件。
  
`data/`  
  存放小说总纲、阶段剧情、章节事件、人物设定与时间线摘要等结构化数据。
  
---
## 项目特点

-**半自动创作流程**  
-**高度可定制、可人工干预**  
-**不依赖 embedding 或隐式语义召回**  
-**所有文件均可直接修改，修改即生效**  

StoryPipeline 更像一个 **创作工作台**，而不是黑箱式生成工具。

---
## 项目定位
这是一个用于实践 **结构化长篇小说创作方法** 的个人项目。  
它关注的不是自动化程度，而是：

> 如何在复杂叙事中，始终保持清晰、稳定与可控。

在“人 × AI 协作创作”的语境下，StoryPipeline提供了一种  
以作者为中心的创作范式。
